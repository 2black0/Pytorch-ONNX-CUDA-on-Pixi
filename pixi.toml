[workspace]
name = "pytorch-pixi"
channels = ["conda-forge"]
platforms = ["linux-64"]

[activation]
env = { PYTHONNOUSERSITE = "1", LD_LIBRARY_PATH = "$CONDA_PREFIX/lib" }

[tasks]
check = "bash scripts/check.sh"
test-torch = "python scripts/test_torch_cuda.py"
test-onnx = "python scripts/test_ort_cuda.py"
clean-libs = "bash scripts/clean_env.sh"
link-opencv = { cmd = "bash scripts/link_opencv.sh", depends-on = ["clean-libs"] }

[dependencies]
python = "3.10.*"
numpy = "*"
pillow = "*"
matplotlib = "*"
onnx = "*"
pyqt6 = "*"
kornia = "*"
tqdm = "*"
scipy = "*"
gtsam = "*"
pyceres = "*"
triton = "*"

[pypi-dependencies]
#opencv-contrib-python = "*"
evo = "*"
g2o-python = "*"
theseus-ai = "*"
rerun = "*"
pypose = "*"

[feature.gpu.system-requirements]
cuda = "12.0" 

[feature.gpu.dependencies]
cuda-version = "12.*" 
pytorch-gpu = "*"
torchvision = "*"

[feature.gpu.pypi-dependencies]
onnxruntime-gpu = "*" 

[feature.cpu.dependencies]
pytorch-cpu = "*"
torchvision = "*"
onnxruntime = "*"

[environments]
default = ["gpu"]
cpu = ["cpu"]
